---
title: "ClockBoard: a zoning system for urban analysis"
runningtitle: "The ClockBoard Zoning System"
# output: rticles::josis_article
# to use bookdown cross references
output:
  bookdown::pdf_book:
    base_format: rticles::josis_article
keywords: "zoning, areal data, zoning systems, modifiable area unit problem"
bibliography: references.bib
author:
   - name: Robin Lovelace
     affiliation: Institute for Transport Studies and Leeds Institute for Data Analytics, University of Leeds, UK
   - name: Martijn Tennekes
     affiliation: Center for Big Data Statistics, Centraal Bureau voor de Statistiek, The Netherlands
   - name: Dustin Carlino
     affiliation: Independent Software Engineer, Lead Developer of A/B Street, USA
abstract: |
  Zones are the building blocks of urban analysis. Fields ranging from
  demographics to transport planning routinely use zones --- spatially
  contiguous areal units that break-up continuous space into discrete
  chunks --- as the foundation for diverse analysis techniques. Key
  methods such as origin-destination analysis and choropleth mapping
  rely on zones with appropriate sizes, shapes and coverage. However,
  existing zoning systems are sub-optimal in many urban analysis
  contexts, for three main reasons: 1) available administrative zoning systems are
  often based on somewhat arbitrary factors; 2) evidence-based zoning
  systems are often highly variable in size and shape, reducing their
  utility for inter-city comparison; and 3) official zoning systems are non-existent,
  not publicly available, or are too coarse, hindering urban analysis
  in many places, especially in low income nations.
  To tackle these three key issues we developed a
  flexible, open and scalable solution: the ClockBoard zoning system.
  ClockBoard consists of 12 segments divided by concentric rings of
  increasing distance, creating a consistent visual frame of reference
  for cities that is reminiscent of a clock and a dartboard. This paper
  outlines the design, potential uses and merits of the ClockBoard
  zoning system and discusses future avenues for research and
  development of new zoning systems based on the experience.
# # # For paper: uncomment below for LaTeX version
# output:
#   bookdown::pdf_book:
#     base_format: rticles::josis_article
#     latex_engine: xelatex
# # For R package vignette
# # output:
# #   bookdown::html_vignette2:
# # vignette: >
# #   %\VignetteIndexEntry{ClockBoard: a zoning system for urban analysis}
# #   %\VignetteEngine{knitr::rmarkdown}
# #   %\VignetteEncoding{UTF-8}
# # pkgdown:
# #   as_is: true
# #   set_null_theme: false
# author:
#    - name: Robin Lovelace
#      affiliation: Institute for Transport Studies and Leeds Institute for Data Analytics, University of Leeds, UK
#    - name: Martijn Tennekes
#      affiliation: Center for Big Data Statistics, Centraal Bureau voor de Statistiek, The Netherlands
#    - name: Dustin Carlino
#      affiliation: Independent Software Engineer, Lead Developer of A/B Street, USA
# keywords: "zoning, areal data, zoning systems, modifiable area unit problem"
# abstract: |
#   Zones are the building blocks of urban analysis. Fields ranging from
#   demographics to transport planning routinely use zones --- spatially
#   contiguous areal units that break-up continuous space into discrete
#   chunks --- as the foundation for diverse analysis techniques. Key
#   methods such as origin-destination analysis and choropleth mapping
#   rely on zones with appropriate sizes, shapes and coverage. However,
#   existing zoning systems are sub-optimal in many urban analysis
#   contexts, for three main reasons: 1) available administrative zoning systems are
#   often based on somewhat arbitrary factors; 2) evidence-based zoning
#   systems are often highly variable in size and shape, reducing their
#   utility for inter-city comparison; and 3) official zoning systems are non-existent,
#   not publicly available, or are too coarse, hindering urban analysis
#   in many places, especially in low income nations.
#   To tackle these three key issues we developed a
#   flexible, open and scalable solution: the ClockBoard zoning system.
#   ClockBoard consists of 12 segments divided by concentric rings of
#   increasing distance, creating a consistent visual frame of reference
#   for cities that is reminiscent of a clock and a dartboard. This paper
#   outlines the design, potential uses and merits of the ClockBoard
#   zoning system and discusses future avenues for research and
#   development of new zoning systems based on the experience.
# runningtitle: "The ClockBoard Zoning System"
# 
# # Explore visual editor options: sentence based line breaks...
# # changing annoying arbitrary character based linebreaks:
# editor_options:
#   markdown:
#     wrap: sentence
# # That automagically reformatted the Rmd doc!
# # Result: it works!
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  fig.align = "center",
  eval = TRUE, # set to false for CRAN submission
  echo = FALSE,
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  cache = TRUE
)
library(zonebuilder)
library(tmap)
library(dplyr)
```

```{r, eval=FALSE}
# To uses josis template:
remotes::install_github("robinlovelace/rticles", ref = "josis")
refs = RefManageR::ReadZotero(group = "418217", .params = list(collection = "8S8LR8TK", limit = 100))
RefManageR::WriteBib(refs, "vignettes/references.bib")
# Set-up notes for pdf version
# convert .tex to .md
# system("pandoc -s -r latex paper.tex -o paper.md")
# # copy josis specific files and ignore them
# f = list.files("~/other-repos/rticles/inst/rmarkdown/templates/josis/skeleton", pattern = "josis", full.names = TRUE)
# file.copy(f, "vignettes")
rmarkdown::render(input = "vignettes/paper.Rmd", output_file = "../zonebuilder-paper.pdf")
browseURL("zonebuilder-paper.pdf")
piggyback::pb_upload("zonebuilder-paper.pdf")
piggyback::pb_download_url("zonebuilder-paper.pdf")
# [1] "https://github.com/zonebuilders/zonebuilder/releases/download/v0.0.2.9000/zonebuilder-paper.pdf"
remotes::install_github("paleolimbot/rbbt")
# library(rbbt)
# rbbt::bbt_update_bib(path_rmd = "vignettes/paper.Rmd")
```

# Introduction

Zoning systems have long been used for a variety of administrative and practical purposes.
Zones demarcating parcels of land have been integral to land ownership, rents and urban policies for centuries, forming the basis of a range of social and economic practices.
Historical examples highlighting the importance of zone layouts include 'tithe maps' determining land ownership and taxes in 18th Century England [@bryant_worcestershire_2007] and the division of cities into discrete areas including legally defined "business, industrial, and residential zones" to tame chaotic urban growth in the exploding US cities in the early 1900s [@baker_zoning_1925].

In the 19th Century, zoning systems became known for political reasons, with 'gerrymandering' entering public discourse and academic research following Elbridge Gerry's apparent attempt to gain political advantage by creating an electoral district in an odd shape that was said to resemble a salamander (hence the term's name combining 'Gerry' and 'salamander') in 1812 [@orr_persistence_1969].
Gerrymandering has since been the topic of countless academic papers that is the beyond the scope of the present paper.

Research research has made great progress in mathematical analysis of zones and more objective assessment of the impacts that the nature of zoning systems can have on zone-based statistics (such as number of votes for a particular party in each zone) and outcomes.
The gerrymandering problem (in itself is a manifestation of the modifiable area unit problem) can be described as a mathematical optimization problem: "$n$ units are grouped into $k$ zones such that some cost function is optimized, subject to constraints on the topology of the zones" [@chou_taming_2006].
Much research has demonstrated the sensitivity of urban analysis outcomes to zone system design, from the way cities are visualised to the [impact of the nature of 'traffic analysis zones' on transport model outputs](http://www.iasi.cnr.it/ewgt/13conference/145_binetti.pdf). 
In fact, this problem is concise definition of the broader "zoning problem" that starts from the assumption that zones are to be composed of one or more basic statistical units (BSUs) [@jelinski_modifiable_1996; @chandra_multi-objective_2021] .
Although the range of outcomes is a finite combinatorial optimisation problem (which combination of BSU-zone aggregations satisfy/optimise some pre-determined criteria) the zoning problem is still hard: "there are a tremendously large number of alternative partitions, a similar number of different results, and only a slightly smaller number of different interpretations" [@openshaw_optimal_1977].

The problem that we tackle in this paper is different, however.
It is 'zoning from scratch': the division of geographic space into zones **starting from a blank slate**, without reference to pre-existing areal units.
The focus of much preceding zoning research on BSU partitioning can be explained by the fact that much geographic data available to academics comes in 'pre-packaged' small areas and because creating zones from nothing is a harder problem.
We disagree with the statement that "existence of individual or non-spatially aggregated data is rare in geography" [@openshaw_optimal_1977], pointing to car crashes, shop locations, species identification data and dozens of other phenomena that can be understood as 'point pattern processes'.
And with advances in computer hardware and software, the 'starting from scratch' approach to zoning system is more feasible.

A number of approaches have tackled the question of how to best divide up geographical space for analysis and visualisation purposes, with a variety of applications.
Functional zone classification is common in the field of remote sensing and associated sub-fields involved in analysing and classifying raster datasets [@ciglic_evaluating_2019; @hesselbarth_landscapemetrics_2019].
While such pixel-based approaches can yield complex and flexible results (depending on the geographic resolution of the input data), they are still constrained by the building blocks of the pixels, which can be seen as a particular type of areal unit, a uniformly sized and shaped BSU.

In this paper we are interested in the division of *continuous space* into completely new areal systems.
This has been done using contour lines to represent lines of equal height, and the concept's generalisation to lines of equal journey time from locations (isochrones) [@long_modeling_2018], population density (isopleths) [@lin_cartographic_2017] and model parameters which continuous geographical space [@paez_exploring_2006].
The boundaries created by these various 'iso' maps are 'procedurally generated' areal units of the type that this paper focuses, but their variability and often irregular shapes make them impractical for many types of urban analysis.

Procedural generation, which involves the generation of data through a repeated and sometimes randomised computational process has long been used to represent physical phenomena [@onrust_ecologically_2017]. The approach has been used to generate spatial entities including roads [@galin_procedural_2010], indoor layouts of buildings [@anderson_augmented_2018] and urban layouts [@mustafa_procedural_2020]. Algorithms have also been developed to place linear features on a map, as illustrated by an algorithm that optimizes the placement of overlapping linear features for cartographic visualisation [@teulade-denantes_routes_2015].
However, no previous research has demonstrated the creation of zoning systems specifically for the purposes of urban analysis.

New visualisation techniques are needed to represent new (or newly quantifiable) concepts and emerging datasets (such as OpenStreetMap) in urban analysis analysis .
The visualisation of direction has been driven by new navigational requirements and datasets, with circular compasses and displays common in land and sea navigational systems since the mid 1900s [@honick_pictorial_1967]. Circular visualisation techniques, in the form of rose diagrams, were used in a more recent study to indicate the most common road directions relative to North [@boeing_spatial_2021]. The resulting visualisations are attractive and easy to interpret, but are not geographical, in the sense that they cannot meaningfully be overlaid on mapped data. The approach we present in this paper is more closely analogous to 'grid sample' approaches used in ecological and population research [@hirzel_which_2002] . Historically, environmental researchers have used rectangular (and usually square) grids to divide up space and decide sampling strategies. Limitations associated with this simplistic strategy have been documented since at least the 1960s, with a prominent paper on geographic sampling strategies outlining advantages and disadvantages of simple random, systematic and stratified sampling techniques in 1967 [@holmes_problems_1967]. Starting with data at the level of raster grid cells and BSUs, a related approach is to sample from within available 'pixels' to generate a representative sample [@thomson_gridsample_2017].

Unlike BSU based zoning systems, grid sampling strategies require no prior zones.
Unlike 'procedurally generated' areas, grid-based strategies generate areal units of consistent sizes and shapes.
However, grid-based strategies are limited in their applicability to urban research because they seldom generate geographically contiguous results and do not account for the strong tendency of human settlements to have a (more-or-less clearly demarcated) central location with higher levels of activity.

Pre-existing zoning systems are often based on administrative regions.
Although those zoning systems are usually in line with the hierarchical organization structure of governmental organizations, and therefore may work well for policy making, there are a couple of downsides to using such zoning systems.
First of all, since a city and its politics change over time, the administrative regions often change accordingly.
This make it harder to do time series analysis.
Since the administrative regions have heterogeneous characteristics, for instance population size, area size, proximity to the city centre, comparing different administrative regions within a city is not straightforward.
Moreover, comparing administrative regions across cities is even more challenging since average scale of an administrative region may vary a lot across cities.

Grid tiles are popular in spatial statistics for a number of reasons.
Most importantly the tiles have a constant area size, which makes comparably possible.
Moreover, the grid tiles will not change over time like administrative regions.
However, one downside is that a grid requires a coordinate reference system (CRS), enforcing (approximately) equal area size.
For continents or large countries, a CRS is always a compromise.
Therefore, the areas of the tiles may vary, or the shape of the tiles may be sheared or warped.

Another downside from a statistical point of view is that population densities are not uniform within a urban area, but concentrated around a centre.
As a consequence, high resolution statistics is preferable in the dense areas, i.e. the centre, and lower resolution statistics in other parts of the city.
That is the reason why administrative regions are often smaller in dense areas.

The approach presented in this paper aims to minimise input data requirements, generate consistent zones comparable between widely varying urban systems, and provide geographically contiguous areal units.
The motivations for generating a new zoning system and use cases envisioned include:

-   Locating cities.
    Automated zoning systems based on a clear centrepoint can support map interpretation by making it immediately clear where the city centre is, and what the scale of the city is.

-   Reference system for everyday life.
    The zone name contains information about the distance to the center as well as the cardinal direction.
    E.g "I live in C12 and work in B3." or "The train station is in the center and our hotel is in B7".
    Moreover, the zones indicate whether walking and cycling is a feasibly option regarding the distance.

-   Aggregation for descriptive statistics / comparability over cities.
    By using the zoning system to aggregate statistics (e.g. on population density, air quality, bicycle use, number of dwellings), cities can easily be compared to each other.

-   Modelling urban cities.
    The zoning system can be used to model urban mobility.

The paper is structured as follows.
The next section outlines the approach, which requires only 2 inputs: the coordinates of the central place in the urban system under investigation, and the minimum radius from that central point that the zoning system should extend.
Section 3 describes a number of potential applications, ranging from rudimentary navigation and location identification to mobility analysis.
Finally, in Section 4, we discuss limitations of the approach and possible directions of research and development to generate additional zoning systems for urban analysis.

# The ClockBoard zoning system

The aim of the ClockBoard zoning system is to tackle the issues associated with available zoning systems and to provide a standard template for analysis of the geographic distribution of urban phenomena between cities internationally.
As outlined above, there is a need for open access zoning systems that are readily available and consistent.

The requirements of urban analysts, geographers, transport modellers and others working with geographic data across cities are diverse. This motivated our approach to design a flexible open source system. Considering urban analysis research and visualisation requirements, we specified a set of criteria which state that zoning systems for urban analysis should:

-   contain intuitively named zones, enabling public communication of research, e.g. with reference common perceptions of space in terms of distance from the city centre and direction relative to North
-   have a well-balanced number of zones since too many or too few zones may cause issues with analysis and visualisation
be easy to visualise without too many or too few zones
-   include zones of consistent and useful sizes, for example with zone areas increasing with distance from the urban centres to reflect relatively high densities in central locations
-   be 'scale agnostic', capable of representing a range of urban forms ranging from extensive cities such as Mexico City to compact cities such as Hong Kong
-   be extensible and based on open source software, enabling others to create alternative zoning systems suited to diverse needs

Considering the above criteria, we explored many zoning options, some of which are illustrated in Figure \@ref(fig:options).
Two key concepts that make up the zoning system described in this paper are concentric annuli and segments defined by radii.

- **Concentric rings** --- formally called 'concentric annuli' --- which emphasise central locations and have been used to explore the relationships between the characteristics of 'focal trees' and surrounding trees in ecological research [@wills_persistence_2016], as shown in Figure \@ref(fig:options) (A).

- **Segments**, defined by radial lines emanating from the central point of the settlement (or other geographic entity) to be divided into zones, as shown in Figure \@ref(fig:options) (B).

Combining these two concepts creates a general approach to zone creation that can be described as 'segmented concentric annuli', one specific implementation of which is shown in Figure \@ref(fig:options) (C).
After a period of informal testing and feedback, we developed and refined the 'ClockBoard' zoning system presented in this paper, which is a specific implementation of the segmented concentric annuli approach to zone creation.

The parameters that define the ClockBoard zoning system were developed in an iterative process.
We experimented with a range of ways of dividing the concentric annuli into different zones by modifying the distances between rings (the annuli borders) and the number of segments per annulus.
It became apparent that zoning systems based on the two organising principles (and modifiable parameters) of concentric annuli and segments held promise, but selecting appropriate settings for each was key to the development of the ClockBoad zoning system, as outlined below.
<!-- commented out the next sentence as it's kind of obvious -->
<!-- The key parameters of annuli distances and number of segments are discussed below. -->


```{r options, fig.cap="Illustration of ideas explored in the lead-up to the development of the ClockBoard zoning system, highlighting the incremental and iterative evolution of the approach.", out.width="32%", fig.show='hold'}
# z1 = zb_zone(x = london_c(), n_segments = 1)
# m1 = qtm(z1, title = "(A) Concentric Annuli")
# sf::sf_use_s2(use_s2 = FALSE)
z1 = zb_zone(london_c(), n_segments = 1, distance_growth = 0)
z1_areas = sf::st_area(z1)
z1_areas_relative = as.numeric(z1_areas / z1_areas[1])
qtm(z1, title = "(A) Concentric Annuli", fill = NULL) +
  tm_layout(frame = FALSE, inner.margins = c(0.02, 0.02, 0.08, 0.02))
qtm(zb_segment(london_c(), n_segments = 12), title = "(B) Clock segments", fill = NULL) +
  tm_layout(frame = FALSE, inner.margins = c(0.02, 0.02, 0.08, 0.02))
qtm(zb_zone(london_c(), n_segments = z1_areas_relative, labeling = "clock", distance_growth = 0), title = "(C) Equal area zones", fill = NULL) +
  tm_layout(frame = FALSE, inner.margins = c(0.02, 0.02, 0.08, 0.02))
```

## Annuli radii

Each annuli is defined by its inner and outer circle.
Given that the radius of the inner circle must the same as the radius of the preceding annuli to ensure geographically contiguity (no gaps) --- except in the special case of the first and central annuli which has no inner circle (or an inner circle with a radius of zero) --- the annuli sizes can be wholly defined by the sequence of numbers defining their out circle radii.

This sequence of numbers can increase by a fixed amount --- e.g. with the outer border of each annuli being 1 km from the centre than the preceding annulus, as shown in Figure \@ref(fig:options) (C) --- or by varying amounts.
In many cases it is useful for zones to be smaller near the centre of the study region surrounding cities.
This truism is often reflected in traffic analysis zones (TAZ) used for transport modelling, which tend to be smaller near central areas where more detail is most important for policy-relevant outputs [@chandra_multi-objective_2021].

After experimenting with various ways of incrementing the annuli width,
<!-- including in proportion to the square of the annuli index, -->
and considering the importance of easy to remember distances from central points from the perspective of readability, interpretation and simplicity of the system, we settled on linear increases in width as a sensible default for the ClockBoard zoning system.
This linear growth leads to distances between the outer circles of each annuli and the central point following in the [triangular number sequence](https://en.wikipedia.org/wiki/Triangular_number) [@ross_dicuil_2019].
This means that all points in the first annuli (labelled A) are up to 1 km way from the city centre; a circle with a diameter of 1 km is an easy to remember (albeit not always accurate) way to define the central area of urban areas [@vinoth_kumar_spatio-temporal_2007].
The furthest points from the central point of the next 8 subsequent annuli in the system (annuli B to I) are 3, 6, 10, 15, 21, 28, 36 and 45 km respectively, meaning that even a large city such as London requires only 8 annuli to cover it entirely (Figure \@ref(fig:london)).
This and other other attributes of the first set of 9 zones in the ClockBoard zoning system in Table \@ref(tab:t1).

```{r t1}
# txt = "Number of rings,Diameter across (km),Area (sq km)
# 1,1,2,3.14
# 2,2,6,28.27
# 9,9,90,6361.73"
# t1 = read.csv(text = txt, check.names = FALSE)
# # calculate t1 on the fly
# t2 = tibble::tibble("N. annuli" = 1:9)
# t2$`Outer annuli label` = LETTERS[1:9]
# t2$`N. zones` = t2$`N. annuli` * 12 - 11
# t2$`Radius (km)` = zonebuilder::zb_100_triangular_numbers[1:9]
# t2$`Area (sqkm)` = pi * t2$`Radius (km)`^2
# t2$`Average zone size (km)` = t2$`Area (sqkm)` / t2$`N. zones`
# knitr::kable(t2, booktabs = TRUE, caption = "Key attributes of first 9 rings used in the ClockBoard zoning system.", digits = 0)
```

## Number of segments

As its name suggests, the ClockBoard zoning system has 12 segments, representing a compromise between specificity of zone identification and ease of comprehension.
On one hand, too few segments result in large and/or unusually shaped zones, as illustrated in a segmented concentric annuli zoning system with four segments per annuli developed by @vinoth_kumar_spatio-temporal_2007 to model urban expansion.
On the other hand, too many segments would result in small zones and make the zone codes harder to understand: imagine a system with 256 segments and saying "I'm in zone E173"!

Another advantage of using 12 segments is that the angular distance between segments are well understood.
The 'clock position' system describes bearings with reference to the face of a clock, relative to the direction of travel or, as is the case with the ClockBoard zoning system, relative to true North.
Under this system, well established in navigation, "12 O'clock" means true North and 3, 6 and 9 O'clock mean East, South and West respectively [@hart_use_1991].
Following this convention, the ClockBoard zoning system aligns segment 12 with true North, enabling users to approximate their location in a city with reference to clock position .

## ClockBoard zones for segmenting urban areas

The result of applying 12 segments and n concentric rings with external diameter increasing as triangular numbers, with n being sufficient to cover the city extent with, is the Clockboard zoning system.
As outlined in the Introduction, the primary motivation for developing the system was urban analysis and the description, visualisation and exploratory analysis of large cities with well-defined central areas such as London, as illustrated in Figure \@ref(fig:london).


```{r london, fig.cap="The clockboard zoning system, applied to Greater London, UK.", out.width="60%"}
london_zones <- zb_zone(london_c(), london_a())
zb_plot(london_zones, palette = "hcl")
```

## Using the ClockBoard zoning system

To enable easy access to the zoning system, we have implemented described above in free and open source software.

### The zonebuilder R package

The concepts were initially implemented in the statistical programming language R, which is available from the Comprehensive R Archive Network ([CRAN](https://cran.r-project.org/package=zonebuilder)) and can be installed from the R command line as follows:

```r
install.packages("zonebuilder")
```

After the package has been installed, its functions can be attached (made available) to the user's workspace as follows:

```{r, echo=TRUE}
library(zonebuilder)
```


A simple zoning system for Tokyo can be created as follows, resulting in the map shown in Figure \@ref(fig:tokyo):

```{r, echo=FALSE, eval=FALSE}
tokyo = tmaptools::geocode_OSM("tokyo", as.sf = TRUE)
dput(tokyo$point)
tokyo_coordinates = data.frame(x = 139.759, y = 35.682)
tokyo = sf::st_as_sf(tokyo_coordinates, coords = c("x", "y"), crs = 4326)
tokyo_area = osmdata::getbb ('tokyo', format_out = 'sf_polygon')
mapview::mapview(tokyo_area$multipolygon)
```

```{r, echo=TRUE}
ClockBoard_tokyo = zb_zone("Tokyo", n_circles = 5)
```



```{r tokyo, fig.cap="ClockBoard zoning system applied to Tokyo.", out.width="50%"}
# library(tmap) # load mapping package
# tmap_mode("view") # interactive visualisation mode
# tm_shape(ClockBoard_tokyo) +
#   tm_borders() +
#   tm_text("label") +
#   tm_scale_bar()
# from system command line:
# pngquant -f --ext .png --quality 60-85 vignettes/tokyo.png 
knitr::include_graphics("tokyo.png")
```

Note that the `n_circles` argument was set to 5, resulting in a zoning system 15 km in radius (see Table \@ref(tab:t1)).
This can be changed; replacing `5` with `9`, for example, would results in a zoning system with an outer circle radius of 45 km.
Furthermore, passing an object representing the geographic extent of Tokyo as a polygon to the `area` argument of the `zb_zone()` function would result in a zoning system that is intersected by Tokyo's boundary.
<!-- Todo: do this, need a .geojson or similar file representing Tokyo's extent. -->

### The zonebuilder Rust crate

To make the project and resulting zones available to more people, we subsequently developed a Rust crate, that enables the creation of ClockBoard zones on all major platforms using a command line interface.
See [github.com/zonebuilders/zonebuilder-rust](https://github.com/zonebuilders/zonebuilder-rust) for details.
<!-- After the Rust crate has been installed, the same zoning system for Tokyo illustrated above can be created with the following command: -->

<!-- ```bash -->
<!-- # todo: update -->
<!-- cargo run > zones.geojson -->
<!-- ``` -->

### Interactive zonebuilder web application

To enable creation of ClockBoard zones for non-programmers and to encourage people to explore alternative zoning systems, we created a simple web application hosted at [zonebuilders.github.io/zonebuilder-rust/](https://zonebuilders.github.io/zonebuilder-rust/) (see Figure \@ref(fig:interactive)). This app leverages the Rust implementation for generating ClockBoards, compiling it to WebAssembly and using the standard open-source [leafletjs.com](https://leafletjs.com) mapping library as an interface.

```{r interactive, fig.cap="Screenshot from simple web application enabling people to create ClockBoard zones from a web browser. The example shows Erbil, Northern Iraq, which was found to have a road layout resembling the ClockBoard zoning system, highlighting the importance of interactive use of the zoning system to fit cities and other urban systems before downloading the resulting data. See the interactive version at zonebuilders.github.io/zonebuilder-rust/.", out.width="75%"}
# See https://github.com/zonebuilders/zonebuilder-rust/issues/42#issuecomment-886627851

u = "https://user-images.githubusercontent.com/1825120/128508694-5b5485ca-6f1b-4c21-bdb6-9269a7981dd5.png"

# # for html version: 
# knitr::include_graphics(u)

# for pdf version:
f = basename(u)
download.file(u, f)
knitr::include_graphics(f)
```

# Applications

The zoning system presented in this paper is a specific implementation concentric segmented annuli, that was designed to support description, exploration and visualisation of monocentric cities.
The zoning system presented, and modifications of the system, could be useful in a range of other areas.
The examples below are designed to provide an insight into how the zoning system could be used.

## Navigation and location

The most basic application of the zoning system could be to provide approximate locations and navigation guidance to people in cities.
As demonstrated by location services such as 'what3words' and open source implementations such as 'whatfreewords' and '[goehashphrase](https://www.qalocate.com/solutions/geohashphrase/)', there is demand for easy-to-remember words/phrases to specify locations in situations where there is no address and where providing longitude/latitude coordinates may not be appropriate or possible [@raposo_virtual_2019].
While not the primary purpose of the ClockBoard zoning system, it can be used to communicate locations in a city.

We have tested this use case by using the zoning system to agree on meeting points to collaborate on the project.
An illustration of how the zoning system was used is shown in Figure \@ref(fig:location), which shows how the ClockBoard zoning system could be used to communicate key locations in a city, from the train station (zone A) to a park (zone C01) and on to the city of Bradford (zone E09) to orientate people new to the city and to describe geographically where things are located using a small amount of information (3 characters).
Without needing to process much data or look at the map, a person who is new to to the city would know that the park is relatively close to the rail station (between 3 and 6 km from the city centre) while Bradford in zone E09 is between 15 and 21 km from the city centre.
Of course the locations are not geographically specific; the zones would be used a broad brush descriptions of place locations before more detailed locations are provided, e.g. through a postcode, an address, or coordinates.

```{r location, out.width="75%", fig.cap="Illustration of how the ClockBoard system could be used to describe the approximate location of places. In this hypothetical example, someone is describing key places to visit in and around Leeds to someone who arrives at the train station in zone A, visits the city's famous Roundhay Park in zone C01, before travelling for an evening meal in Bradford, in zone E09."}
# ClockBoard_leeds = zb_zone(x = "leeds")
# ClockBoard_leeds$label_locations = ""
# i = grepl(pattern = "A|C01|E09", x = ClockBoard_leeds$label)
# ClockBoard_leeds$label_locations[i] = ClockBoard_leeds$label[i]
# tmap_mode("view")
# tm_shape(ClockBoard_leeds) +
#   tm_borders() +
#   tm_basemap(server = leaflet::providers$Esri.WorldTopoMap) +
#   tm_text("label_locations", size = 2) +
#   tm_scale_bar()
# download.file(
#   "https://user-images.githubusercontent.com/1825120/127722684-e4f0f58a-44b2-48b9-8bdd-cd09bae4e250.png",
#   "navigation-small.png"
# )
download.file(
  "https://user-images.githubusercontent.com/1825120/127722701-36ca3674-0522-40d6-9a69-e745ca628bca.png",
  "navigation.png"
)
knitr::include_graphics("navigation.png")
# knitr::include_graphics("https://user-images.githubusercontent.com/1825120/127722701-36ca3674-0522-40d6-9a69-e745ca628bca.png")
```


## Exploring city scale data

The ClockBoard zoning system is well suited to exploratory analysis of city-scale spatial data.
An example that demonstrates how the system can simplify the presentation of spatially variable data is shown in Figure \@ref(fig:cityscale), which presents open access data on air quality from the London Atmospheric Emissions Inventory.
The presentation of the same data at four different levels of geographic resolution highlights the impacts that zoning system choice can have on data analysis, with each having advantages and disadvantages.
The most geographically detailed zoning system in which the data is available is the rectangular grid shown in the far left facet (A).
This presentation of the data is ideal for many purposes, demonstrating the variability in air quality over relatively small areas (1 km grid cells) across London.

In cases when geographic aggregation is required, e.g. to present the data in small graphics that will be printed at low resolution (e.g. newspaper visualisations and infographics), two common approaches are to use an existing administrative zoning system (with well known London Borough boundaries used to aggregate the data presented in facet B in Figure \@ref(fig:cityscale)) and to use a simplified geographical representation or geographically arranged facets [@dorling_area_2011].
Both approaches have advantages, with existing and well-known zoning systems enabling map readers familiar with city to orient themselves and interpret the map.
In this context and with reference to Figure \@ref(fig:cityscale), the ClockBoard zoning system has the following advantages as a basis for choropleth maps:

- Simple and consistent zone shapes for easy map reading
- The circular shape of zone boundaries make the results easy to place, requiring a 1:1 aspect ratio (except when the zones are clipped, as in map D)
- The shape of the zones draws attention to citywide spatial patterns, with map C highlighting the clear tendency for air quality to improve with distance from the city centre and the comparatively poor air quality in segments 3 and 9

The final advantage is particularly notable when comparing the ClockBoard zoning system with large official zone (borough) boundaries in London.
Because of the large and irregular zone shapes in map B, the strength of the relationship between distance from central London and air quality is not as clear as when using ClockBoard zones as the frame of reference in maps C and D in Figure \@ref(fig:cityscale).
This benefit is especially noticeable towards the outskirts of London, where large outer boroughs such as Bromley (far southeast London) fail to communicate the fact that PM10 levels drop below 1 ug/m^3 in outer London.


```{r cityscale, fig.height=2, out.width="100%", fig.cap="Illustration of the ClockBoard zoning system used to visualise a geographically dependendent phenomena: air quality, measured in mass of PM10 particles per cubic meter from the London Atmospheric Emissions Inventory. The facets show the data in spatial grid available from the LAEI, facet Am and aggregated to London boroughs B, to ClockBoard zones covering all the input data shown in C, and ClockBoard zones clipped by the administrative boundary of Greater London in D."}
# file.edit("data-raw/london-figures.R") # to reproduce the figure

# For PDF version with vector graphics:
tmap_mode("plot")
tm1 = readRDS(url("https://github.com/zonebuilders/zonebuilder/releases/download/v0.0.2.9000/tm1.Rds"))
tm1

# u = "https://github.com/zonebuilders/zonebuilder/releases/download/v0.0.2.9000/cityscale.png"
# # f = basename(u)
# # if(!file.exists(f)) download.file(url = u, destfile = f)
# # knitr::include_graphics(f) # for local high-res version, not working
# knitr::include_graphics(u)
```

The example of air quality presented in Figure \@ref(fig:cityscale) highlights that the ClockBoard zoning system is well suited for the analysis and visualisation of phenomena in which a central place (London city centre in this case) plays a major role, directly or indirectly.
(Not all cities have a 'monocentric' structure, something we discuss in Section \@ref(discussion).)
The prevalence of particulate matter in the air relates to the level of industrial, transport and other activities in the surrounding area, which clearly increases with proximity to central London.
The same can be said of many other phenomena which become more, less, or more and then less, common with distance from central places.
The tragic phenomena of road traffic casualties --- which relate to travel volumes, speeds and transport infrastructure design --- also relates (albeit in different ways in different cities) to proximity to central places, something we explore in the next subsection to highlight another use of the ClockBoard zoning system: comparison between cities.

<!-- Todo if time allows: add an example of road traffic casualties for London mirroring the cityscale figure above. -->

## Inter-city comparison of geographically variable phenomena

The ClockBoard zoning system can enable effective comparison between cities by providing a consistent frame of reference.
While official boundaries can vary greatly in size and shape, based on sometimes arbitrary factors such as historic boundaries, ClockBoard zones are always the same size, shape and orientation.
Using the system can provide a basis of evidence-based discussion of a wide range of phenomena.
The example shown in Figure \@ref(fig:intercity) demonstrates this with reference to a policy-relevant example: the number of people killed and seriously injured while cycling in major UK cities.
Addressing issues associated with reporting only number of casualties per unit area, a practice that can miss dangerous places which have a high casualty rate per unit time or distance cycled [@mindell_exposure-based_2012], we show data on the number of people killed and seriously injured while cycling per billion kilometres based on estimates from the Propensity to Cycle Tool [@lovelace_propensity_2017].


```{r intercity, fig.width=7, message=FALSE, warning=FALSE, fig.cap="Use of the ClockBoard zoning system to support inter-city comparison of a policy relevant phenomenon. The maps show the spatial distribution of cycling casualties per billion km cycled, a measure that requires spatial data aggregation for meaningful results.", out.width="75%"}
# download preprocessed data (processing script /data-raw/crashes.R)
df = readRDS(gzcon(url("https://github.com/zonebuilders/zonebuilder/releases/download/0.0.1/ksi_bkm_zone.rds")))
uk = readRDS(gzcon(url("https://github.com/zonebuilders/zonebuilder/releases/download/0.0.1/uk.rds")))
thames = readRDS(gzcon(url("https://github.com/zonebuilders/zonebuilder/releases/download/0.0.1/thames.rds")))
# df = readRDS("ksi_bkm_zone.rds")
# uk = readRDS("uk.rds")
# thames = readRDS("thames.rds")
# filter: set zones with less than 10,000 km of cycling per yer to NA
df_filtered = df %>% 
  mutate(ksi_bkm = ifelse((bkm_yr * 1e09) < 2e04, NA, ksi_bkm))
tmap_mode("plot")
tm_shape(uk) +
 tm_fill(col = "white") +
tm_shape(df_filtered, is.master = TRUE) +
  tm_polygons("ksi_bkm", breaks = c(0, 1000, 2500, 5000, 7500, 12500), textNA = "Too little cycling", title = "Killed and seriously injured cyclists\nper billion cycled kilometers") +
  tm_facets(by = "city", ncol=4) +
  tm_shape(uk) +
  tm_borders(lwd = 1, col = "black", lty = 3) +
  tm_shape(thames) +
  tm_lines(lwd = 1, col = "black", lty = 3) +
  tm_layout(bg.color = "lightblue")
```

The results illustrated in Figure \@ref(fig:intercity) show that while London has a high absolute crash rate, it is relatively safe per km cycled.
The ClockBoard zoning system also allows for aggregation at a consistent spatial resolution, enabling the identification of potential crash hotspots in specific parts of Birmingham (zones D12 and E06) and Sheffield (zone D11).

Another example of using ClockBoards to compare cities (and phenomena that take place in them) is shown in Figure \@ref(fig:popdens), which shows population density in 30 major cities using the clockboard zoning system not as unit for aggregation but as a reference grid.
The example highlights the utility of ClockBoard for communicating not only inter-city differences in the magnitude and spatial distribution of phenomena, but also geographical extent.
While Singapore and Sydney have similar total official populations (of 5.8 and 5.3 million people, respectively), based on the number of people with their respective administrative boundaries, the size and shape of each city is very different, highlighted by the fact that in Singapore there are few people beyond ring F (located 15 to 20 km from the centre), while in Sydney (and many other cities) there are substantial numbers of people living in ring I (located 36 to 45 km from the centre).
<!-- Do we want to say anything else about this here? -->

```{r popdens, fig.cap="ClockBoard for 30 world cites. The blue raster grid cells represent open access population estimates from the WorldPop project; the red lines are administrative borders (where they could be found).", out.width="60%"}
u = "https://user-images.githubusercontent.com/2444081/109546760-e510d480-7aca-11eb-83cc-c92c582cefeb.png"

# # For HTML version:
# knitr::include_graphics(u)

# For LaTeX version
f = basename(u)
if(!file.exists(f)) download.file(u, f)
knitr::include_graphics(f)
```


<!-- Todo: add mobility analysis section, e.g. showing OD data aggregated to different levels, if time permits (RL) -->
<!-- ## Mobility analysis -->


# Discussion and conclusion

The ClockBoard zoning system presented in this paper overcomes some of the issues associated with commonly available administrative zoning systems in many parts of the world, from the perspective of urban analysis of monocentric cities.
The three example applications demonstrate potential use cases for informal communication about and navigation within cities; exploratory data analysis and visualisation of geographic data within a single city; and visual and quantitative comparison of geographic phenomena between cities.
Of these, we expect that the last application of ClockBoard, and similar zoning systems, will be of most use to urban analysts and others working with city-scaled datasets; having a shared geographic frame of reference as the basis for comparing not only magnitudes and counts of phenomena withing consistently sized zones, but also the geographic extent of phenomena --- without the sometimes unhelpful influence of administrative city boundaries --- could enable more objective and easier to interpret inter-city comparison projects.

Pros:

-   Most cities have a radial plan around a central area, which is often a historic centre or a central business area. Typically, this centre is not only the geographic centre, but also the busiest area in terms of daytime population. Often the main nodes in the urban transport network are also located in or near the city centre. Note that many cities already consist of concentric rings, separated by a ring road. (See also <https://en.wikipedia.org/wiki/City_centre> which describes the centre as the heart of the city)

Cons:

-   Some cities have two or more centres.
    Many cities have a central business discrict or financial discrict which not always coinsides with the historic city centre.

-   In urban areas with nearby cities, it may not always be clear where one cities ends and another begins.
    Also, small cities may be located within the metropolitan area of a larger city (e.g. the Dutch cities The Hague/Delft)

<!-- Compare ClockBoard to a particular city's existing zones, argue that it could replace the TAZs and other domain-specific systems? -->

<!-- World cities todo: create appendix-->

<!-- ============ -->

<!-- ![ClockBoard for 36 cities, with population density shown in blue, and -->

<!-- continent shown in the header color.](cities_page1.png){#fig:cities1 -->

<!-- width="\\textwidth"} -->

<!-- ![(continued)](cities_page2.png){#fig:cities2 width="\\textwidth"} -->

<!-- ![(continued)](cities_page3.png){#fig:cities3 width="\\textwidth"} -->

<!-- # Old paper -->

<!-- # Introduction -->

<!-- ### Current situation -->

<!-- Statistics, policy making and transport planning are often based on administrative regions. However, there are a couple of downsides to using administrative regions. First of all, since a city and its politics change over time, the administrative regions often change accordingly. This make it harder to do time series analysis. Since the administrative regions have heterogeneous characteristics, for instance population size, area size, proximity to the city centre, comparing different administrative regions within a city is not straightforward. Moreover, comparing administrative regions across cities is even more challenging since average scale of an administrative region may vary a lot across cities. -->

<!-- Another downside from a statistical point of view is that population densities are not uniform within a urban area, but concentrated around a centre. As a consequence, high resolution statistics is preferable in the dense areas, i.e. the centre, and lower resolution statitics in other parts of the city. That is the reason why administrative regions are often smaller in dense areas. -->

<!-- ### Why is it needed/handy? -->

<!-- * Locating cities. By having a ClockBoard zoning system for a city, it is immediate clear where the city centre is, and what the scale of the city is.  -->

<!-- * Reference system of everyday live. The zone name contains information about the distance to the center as well as the cardinal direction. E.g "I live in C12 and work in B3." or "The train station is in the center and our hotel is in B7". Moreover, the zones indicate whether walking and cycling is a feasibly option regarding the distance.    -->

<!-- * Aggregation for descriptive statistics / comparability over cities. By using the zoning system to aggregate statistics (e.g. on population density, air quality, bicycle use, number of dwellings), cities can easily be compared to each other. -->

<!-- * Modelling urban cities. The zoning system can be used to model urban mobility. -->

<!-- ### Arguments / discussion -->

<!-- Pros: -->

<!-- * Most cities have a radial plan around a central area, which is often a historic centre or a central business area. -->

<!-- Typically, this centre is not only the geographic centre, but also the busiest area in terms of daytime population. Often the main nodes in the urban transport network are also located in or near the city centre. Note that many cities already consist of concentric rings, separated by a ring road. (See also https://en.wikipedia.org/wiki/City_centre which describes the centre as the heart of the city) -->

<!-- Cons: -->

<!-- * Some cities have two or more centres. Many cities have a central business discrict or financial discrict which not always coinsides with the historic city centre. -->

<!-- * In urban areas with nearby cities, it may not always be clear where one cities ends and another begins. Also, small cities may be located within the metropolitan area of a larger city (e.g. the Dutch cities The Hague/Delft)  -->

<!-- Comparing two cities can be difficult due to incomparable zoning systems. -->

<!-- Take the example of city A is provided in a detailed zoning system composed of hundreds of small, irregular areas while city B is composed only of 9 irregular zones -->

<!-- TODO: reference to https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0050606 -->

# References
